<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT, Sphenginx" />





  <link rel="alternate" href="/atom.xml" title="小崔随想录" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="认真生活，开心工作！">
<meta property="og:type" content="website">
<meta property="og:title" content="小崔随想录">
<meta property="og:url" content="http://sphenginx.github.io/index.html">
<meta property="og:site_name" content="小崔随想录">
<meta property="og:description" content="认真生活，开心工作！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小崔随想录">
<meta name="twitter:description" content="认真生活，开心工作！">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> 小崔随想录 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">小崔随想录</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">独立之精神, 自由之思想！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            公益404
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/18/grew/" itemprop="url">
                  成熟之解BY余秋雨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-06-18T20:03:01+08:00" content="2017-06-18">
              2017-06-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/人生百态/" itemprop="url" rel="index">
                    <span itemprop="name">人生百态</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/18/grew/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/18/grew/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u5E8F"><a href="#u5E8F" class="headerlink" title="序"></a>序</h2><blockquote>
<p>   高中时语文老师推荐读余秋雨的书，自此欲罢不能，然随着年龄的增长，工作压力和生活琐事日益增多，竟渐渐迷失自己，生活工作的一塌糊涂。 今日又读到此文，心有所悟，特整理到博客，以此自勉。 惟愿有生之年早日达到此高度。</p>
</blockquote>
<h2 id="u6B63_u6587"><a href="#u6B63_u6587" class="headerlink" title="正文"></a>正文</h2><p><strong>成熟是一种明亮而不刺眼的光辉，一种圆润而不腻耳的音响，一种不再需要对别人察言观色的从容，一种终于停止向周围申诉求告的大气，一种不理会哄闹的微笑，一种洗刷了偏激的淡漠，一种无须声张的厚实，一种能够看得很远却又并不陡峭的高度。</strong></p>
<p>我一直认为，某个时期，某个社会，即使所有的青年人和老年人都中魔了，只要中年人不荒唐，事情就坏不到哪里去。</p>
<p>在中年，青涩的生命之果变得如此丰满，喧闹的青春冲撞沉淀成了雍容华贵，连繁重的社会责任也有可能溶解为日常的生活情态。</p>
<p>到了该自立的年岁还不知道精神上的自立，这是中国很多中年人的共同悲剧。</p>
<p>天天期待着上级的指示、群众的意见、家人的说法，然后才能跨出每一步——这是尚未精神断奶的标志。</p>
<p>最可怕的是，谁也没有断奶，而社会上又没有那么多上好的乳汁，因此开始了对各种伪劣饮料的集体吮吸。在一片响亮而整齐的吮吸声上面，是那些爬满皱纹却还未苍老的脸。</p>
<p>中年人最容易犯的毛病，是把一切希望都寄托于自己的老年。</p>
<p>如今天天节衣缩食、不苟言笑、忍气吞声，都是在争取着一个有尊严、有资财、有自由的老人。</p>
<p>但是，我们无数次看到了，一个窝囊的中年抵达不到一个欢快的老年。这正像江河，一个浑浊的上段不可能带来一个清澈的下段。</p>
<p>习惯了郁闷的，只能继续郁闷；习惯了卑琐的，只能保持卑琐。而且，由于暮色苍茫间的体力不支、友朋散失，郁闷只能更加郁闷，卑琐只能更加卑琐。</p>
<p>只有在中年树起独立的桅杆，扬起高高的白帆唱出响亮的歌声，才会有好风为你鼓劲，群鸥为你引路，找到一个个都在欢迎你的安静港湾，供你细细选择。</p>
<p>中年人的坚守，应该从观点上升到人格，而人格难以言表。在中年人眼前，大批的对峙消解了，早年的对手失踪了，昨天的敌人无恨了，更多的是把老老少少各色人等照顾在自己身边。</p>
<p>请不要小看这“照顾”二字，中年人的魅力至少有一半与此相关。</p>
<p>中年人失去方寸的主要特征是忘记了自己的年龄，一会儿要别人像对待青年那样关爱自己，一会儿又要别人像对待老人那样尊敬自己，明明一个大男人却不能对任何稍稍大一点的问题作出决定，频频找领导倾诉衷肠，出了什么事情又逃得远远的，不敢负一点责任。在家里，他们训斥孩子就像顽童吵架，没有一点身为人父的慈爱和庄重；对妻子，他们也会轻易地倾泻出自己的精神垃圾来酿造痛苦，全然忘却自己是这座好不容易建造起来的情感楼宇的顶梁柱；甚至对年迈的父母，他们也会任性赌气，极不公平地伤害着已经走向衰弱的身影。</p>
<p>西方一位哲人说，只有饱经沧桑的老人才会领悟真正的人生哲理，同样一句话，出自老人之口比出自青年之口厚重百倍。对此，我不能全然苟同。</p>
<p>哲理产生在两种相反力量的周旋之中，因此它更垂青于中年。世上一切杰出的哲学家都在中年完成了他们的思想体系，便是证据。</p>
<p>人生就是这样，年轻时，怨恨自己年轻，年迈时，怨恨自己年迈，这倒常常促使中年处于一种相对冷静的疏离状态和评判状态，然后一边慰抚年幼者，一边慰抚年老者。我想，中年在人生意义上的魅力，就在于这双向疏离和双向慰抚吧。</p>
<p>因双向疏离，他们变得洒脱和沉静；因双向慰抚，他们变得亲切和有力。但是，也正因为此，他们有时又会感到烦心和惆怅，他们还余留着告别天真岁月的伤感，又迟早会产生暮岁将至的预感。他们置身于人生凯旋的中心点，环视四周，思前想后，不能不感慨万千。</p>
<p>老年是如诗的年岁。这种说法不是为了奉承长辈。</p>
<p>中年太实际、太繁忙，在整体上算不得诗。青年时代常常被诗化，但青年时代的诗太多激情而缺少意境，按我的标准，缺少意境就算不得好诗。<br>只有到了老年，沉重的使命已经卸除，生活的甘苦也已了然，万丈红尘已移到远处，静下来的周际环境和放慢了的生命节奏加在一起，构成了一种总结性、归纳性的轻微和声，诗的意境出现了。</p>
<p>除了极少数命苦的老人，老年岁月总是比较悠闲。老年人可能不会写诗或已经不再写诗，但他们却以诗的方式生存着。看街市忙碌，看后辈来去，看庭花凋零，看春草又绿，而思绪则时断时续、时喜时悲、时真时幻。</p>
<p>当然会产生越来越多的生理障碍，但即便障碍也构成一种让人仰视的形态，就像我们面对枝干斑驳的老树，老树上的枯藤残叶，也会感到诗的存在。<br>中青年的世界的强悍，也经常需要一些苍老的手来救助。平时不容易见到，一旦有事则及时伸出，救助过后又立即消失，神龙见首不见尾。这是一种早已退出社会主体的隐性文化和柔性文化，隐柔中沉积着岁月的硬度，能使后人一时启悟，如与天人对晤。老年的魅力，理应在这样的高位上偶尔显露。不要驱使，不要强求，不要哄抬，只让它们成为人生的写意笔墨，似淡似浓，似有似无。</p>
<p>长江的流程也像人的一生，在起始阶段总是充满着奇瑰和险峻，到了即将了结一生的晚年，怎么也得走向平缓和实在。</p>
<p>不要因为害怕被别人误会而等待理解。现代生活各自独立、万象共存。东家的柳树矮一点，不必向路人解释本来有长高的可能；西家的槐树高一点，也不必向邻居说明自己并没有独占风水的企图。</p>
<p>做一件新事，大家立即理解，那就不是新事；出一个高招，大家又立即理解，那也不是高招。没有争议的行为，肯定不是创造；没有争议的人物，肯定不是创造者。任何真正的创造都是对原有模式背离，对社会适应的突破，对民众习惯的挑战。如果眼巴巴地指望众人理解，创造的纯粹性必然会大大降低。平庸，正在前面招手。</p>
<p>回想一下，我们一生所做的比较像样的大事，连父母亲也未必能深刻理解。父母虽缔造了我们却理解不了我们，这便是进化。</p>
<p>人生不要光做加法。在人际交往上，经常减肥、排毒，才会轻轻松松地走以后的路。我们周围很多人，实在是被越积越厚的人际关系脂肪层堵塞住了，大家都能听到他们既满足又疲惫的喘息声。</p>
<p>向往峰巅，向往高度，结果峰巅只是一道刚能立足的狭地。不能横行，不能直走，只享一时俯视之乐，怎可长久驻足安坐？上已无路，下又艰难，我感到从未有过的孤独与惶恐。世间真正温煦的美色，都熨帖着大地，潜伏在深谷。君临万物的高度，到头来构成了自我嘲弄。我已看出了它的讥谑，于是急急地来试探下山的陡坡。人生真是艰难，不上高峰发现不了什么，上了高峰又抓住不了什么。看来，注定要不断地上坡下坡，上坡下坡。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/14/how-to-work/" itemprop="url">
                  如何高效率的工作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-10-14T20:03:01+08:00" content="2016-10-14">
              2016-10-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/人生百态/" itemprop="url" rel="index">
                    <span itemprop="name">人生百态</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/14/how-to-work/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/14/how-to-work/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u4F60_u4E0D_u52AA_u529B_uFF0C_u8C01_u4E5F_u7ED9_u4E0D_u4E86_u4F60_u60F3_u8981_u7684_u751F_u6D3B"><a href="#u4F60_u4E0D_u52AA_u529B_uFF0C_u8C01_u4E5F_u7ED9_u4E0D_u4E86_u4F60_u60F3_u8981_u7684_u751F_u6D3B" class="headerlink" title="你不努力，谁也给不了你想要的生活"></a>你不努力，谁也给不了你想要的生活</h2><p>近被朋友圈刷屏了，简单的两个聊天记录，拿2000工资与20000工资的有什么区别？<strong>不论做什么，走心最重要！</strong></p>
<p>很多时候，我们失败都不是因为“硬件”不行，而是“软实力”欠佳。</p>
<p>若都是刚进公司的新人，大家能力是差不多的，随着时间的推移，情商高的往往都会比情商低的更容易得到赏识或提拔；所以，在技能相对稳定的情况下，我们一定要努力优化自己的处事方法。</p>
<p><strong>机会是留给有准备的人的，要别人推一把你才走一步，那你跟猪又有什么区别。</strong></p>
<hr>
<p>如图所示：3张图揭示人与人之间的差别！</p>
<h3 id="u60C5_u666F_u4E00"><a href="#u60C5_u666F_u4E00" class="headerlink" title="情景一"></a>情景一</h3><p><img src="http://sphenginx.github.io/images/work/1.png" alt="普通员工1"><br><img src="http://sphenginx.github.io/images/work/2.png" alt="普通员工2"></p>
<h3 id="u60C5_u666F_u4E8C"><a href="#u60C5_u666F_u4E8C" class="headerlink" title="情景二"></a>情景二</h3><p><img src="http://sphenginx.github.io/images/work/3.png" alt="优秀员工"></p>
<p>那么问题来了，</p>
<p>你能看出老员工和新员工之间的差别吗？</p>
<p><strong>如果你是老板，你更愿意聘用哪一个？</strong></p>
<h2 id="u4F18_u79C0_u5458_u5DE5_VS__u666E_u901A_u5458_u5DE5"><a href="#u4F18_u79C0_u5458_u5DE5_VS__u666E_u901A_u5458_u5DE5" class="headerlink" title="优秀员工 VS 普通员工"></a>优秀员工 VS 普通员工</h2><h3 id="u5173_u4E8E_u521A_u5165_u804C"><a href="#u5173_u4E8E_u521A_u5165_u804C" class="headerlink" title="关于刚入职"></a>关于刚入职</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>看重工资的高低，在一无所长的前提下，没有想过学习丰富的工作经验和职业技能。</td>
<td>更看重宝贵的工作经验，踏踏实实的去学习业务技能，他相信只要有丰富的经验，以后无论到哪都能赢得高薪。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u5BF9_u5F85_u95EE_u9898"><a href="#u5173_u4E8E_u5BF9_u5F85_u95EE_u9898" class="headerlink" title="关于对待问题"></a>关于对待问题</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>在工作中会发现各种各样的问题，对于问题他们往往以抱怨的态度去对待，而没有想方法去解决</td>
<td>在工作过程中，碰到问题会冷静的分析原因，并通过各种手段去解决，慢慢培养了一种解决问题的能力。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u6267_u884C_u529B"><a href="#u5173_u4E8E_u6267_u884C_u529B" class="headerlink" title="关于执行力"></a>关于执行力</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>对于上司交代的问题本着能做就做，不能做就慢慢磨，执行效果较差。</td>
<td>上司交代的事情积极去解决，遇到问题会积极与上司沟通请示，执行效果好。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u4E2A_u6027"><a href="#u5173_u4E8E_u4E2A_u6027" class="headerlink" title="关于个性"></a>关于个性</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>个性张扬，以自我为中心，不善于处理自己与同事领导的关系，往往给人一种很浮躁的感觉。</td>
<td>为人谦虚低调，能协调好与领导同事的关系，人际关系非常好。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u4E0B_u73ED_u540E"><a href="#u5173_u4E8E_u4E0B_u73ED_u540E" class="headerlink" title="关于下班后"></a>关于下班后</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>下班后往往通过看电视、打打游戏等方式，度过一段休闲时光。</td>
<td>下班后会抽出时间回顾今天一天的工作内容，反思不足之处，并规划好第二天的工作内容。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u5DE5_u4F5C_u91CD_u70B9"><a href="#u5173_u4E8E_u5DE5_u4F5C_u91CD_u70B9" class="headerlink" title="关于工作重点"></a>关于工作重点</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>工作杂乱无章，搞不清楚工作的核心内容，工作往往忙起来手足无措。</td>
<td>能很好的做好工作规划，找准核心工作内容，即使忙起来也能井然有序。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u5BA2_u6237_u6C9F_u901A"><a href="#u5173_u4E8E_u5BA2_u6237_u6C9F_u901A" class="headerlink" title="关于客户沟通"></a>关于客户沟通</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>和客户沟通仅局限于单纯的送货收款，没有考虑到客户的实际需求，往往工作很辛苦，但是成效却很低。</td>
<td>能很好的处理与客户的客情关系，准确的找到客户实际需求，并结合客户需求达成销售。往往事半功倍。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u89C6_u754C"><a href="#u5173_u4E8E_u89C6_u754C" class="headerlink" title="关于视界"></a>关于视界</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>缺乏宏观思考，经常纠结于某个终端问题，有时为了应对单个终端问题不惜提高政策从而影响了整个市场价格体系。</td>
<td>从市场整体角度出发，能很好的协调好各个渠道之间的市场问题，对于违反市场规律的个别终端坚决予以治理。</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u6279_u8BC4"><a href="#u5173_u4E8E_u6279_u8BC4" class="headerlink" title="关于批评"></a>关于批评</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>对忠言逆耳理解的不透彻，总认为自己想的是对的，把上司或资深前辈的意见或建议不当一回事，我行我素。</td>
<td>能谦虚的接受批评，认识到自己所犯错误在哪，并积极改正！</td>
</tr>
</tbody>
</table>
<h3 id="u5173_u4E8E_u804C_u4E1A_u89C4_u5212"><a href="#u5173_u4E8E_u804C_u4E1A_u89C4_u5212" class="headerlink" title="关于职业规划"></a>关于职业规划</h3><table>
<thead>
<tr>
<th>普通员工</th>
<th>优秀员工</th>
</tr>
</thead>
<tbody>
<tr>
<td>没有职业规划，对自己想要什么没概念，能做多久算多久，风风光光是一辈子，窝窝囊囊也是一辈子，得过且过。</td>
<td>有自己的职业规划，知道自己想要什么，也知道如何去努力。</td>
</tr>
</tbody>
</table>
<p><img src="http://sphenginx.github.io/images/work/0.png" alt="你不努力，谁也给不了你想要的生活"></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/18/select-for-update/" itemprop="url">
                  MySQL 中的 SELECT FOR UPDATE
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-09-18T16:03:01+08:00" content="2016-09-18">
              2016-09-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日薪越亿/" itemprop="url" rel="index">
                    <span itemprop="name">日薪越亿</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/18/select-for-update/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/18/select-for-update/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="MySQL__u4F7F_u7528SELECT__u2026_FOR_UPDATE__u505A_u4E8B_u52A1_u5199_u5165_u524D_u7684_u786E_u8BA4"><a href="#MySQL__u4F7F_u7528SELECT__u2026_FOR_UPDATE__u505A_u4E8B_u52A1_u5199_u5165_u524D_u7684_u786E_u8BA4" class="headerlink" title="MySQL  使用SELECT … FOR UPDATE 做事务写入前的确认"></a>MySQL  使用SELECT … FOR UPDATE 做事务写入前的确认</h2><p>以MySQL 的InnoDB 为例，预设的Tansaction isolation level 为REPEATABLE READ，在SELECT 的读取锁定主要分为两种方式:</p>
<p><code>SELECT ... LOCK IN SHARE MODE</code>  、  <code>SELECT ... FOR UPDATE</code></p>
<p>这两种方式在事务(Transaction) 进行当中SELECT 到同一个数据表时，都必须等待其它事务数据被提交(Commit)后才会执行。而主要的不同在于LOCK IN SHARE MODE 在有一方事务要Update 同一个表单时很容易造成死锁 。</p>
<p>简单的说，如果SELECT 后面若要UPDATE 同一个表单，最好使用SELECT … UPDATE。</p>
<p>举个例子: 假设商品表单products 内有一个存放商品数量的quantity ，在订单成立之前必须先确定quantity 商品数量是否足够(quantity&gt;0) ，然后才把数量更新为1。</p>
<p>不安全的做法:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT quantity FROM products WHERE id=3;  &#10;UPDATE products SET quantity = 1 WHERE id=3;</span><br></pre></td></tr></table></figure></p>
<p>为什么不安全呢?</p>
<p>少量的状况下或许不会有问题，但是大量的数据存取「铁定」会出问题。</p>
<p>如果我们需要在quantity&gt;0 的情况下才能扣库存，假设程序在第一行SELECT 读到的quantity 是2 ，看起来数字没有错，但是当MySQL 正准备要UPDATE 的时候，可能已经有人把库存扣成0 了，但是程序却浑然不知，将错就错的UPDATE 下去了。</p>
<font color="red"><strong>因此必须透过的事务机制来确保读取及提交的数据都是正确的。</strong></font>

<p>于是我们在MySQL 就可以这样测试: (注1)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET AUTOCOMMIT=0;  &#10;BEGIN WORK;  &#10;SELECT quantity FROM products WHERE id=3 FOR UPDATE; //&#27492;&#26102;products &#25968;&#25454;&#20013;id=3 &#30340;&#25968;&#25454;&#34987;&#38145;&#20303;(&#27880;3)&#65292;&#20854;&#23427;&#20107;&#21153;&#24517;&#39035;&#31561;&#24453;&#27492;&#27425;&#20107;&#21153; &#25552;&#20132;&#21518;&#25165;&#33021;&#25191;&#34892;  &#10;SELECT * FROM products WHERE id=3 FOR UPDATE;  //(&#27880;2) &#22914;&#27492;&#21487;&#20197;&#30830;&#20445;quantity &#22312;&#21035;&#30340;&#20107;&#21153;&#35835;&#21040;&#30340;&#25968;&#23383;&#26159;&#27491;&#30830;&#30340;&#12290;  &#10;UPDATE products SET quantity = &#39;1&#39; WHERE id=3;  &#10;COMMIT WORK;</span><br></pre></td></tr></table></figure></p>
<p>提交(Commit)写入数据库，products 解锁。</p>
<p>注1: BEGIN/COMMIT 为事务的起始及结束点，可使用二个以上的MySQL Command 视窗来交互观察锁定的状况。<br>注2: 在事务进行当中，只有SELECT … FOR UPDATE 或LOCK IN SHARE MODE 同一笔数据时会等待其它事务结束后才执行，一般SELECT … 则不受此影响。<br>注3: 由于InnoDB 预设为Row-level Lock，数据列的锁定可参考这篇。<br>注4: InnoDB 表单尽量不要使用LOCK TABLES 指令，若情非得已要使用，请先看官方对于InnoDB 使用LOCK TABLES 的说明，以免造成系统经常发生死锁。  </p>
<h2 id="MySQL_SELECT__u2026_FOR_UPDATE__u7684Row_Lock__u4E0ETable_Lock"><a href="#MySQL_SELECT__u2026_FOR_UPDATE__u7684Row_Lock__u4E0ETable_Lock" class="headerlink" title="MySQL SELECT … FOR UPDATE 的Row Lock 与Table Lock"></a>MySQL SELECT … FOR UPDATE 的Row Lock 与Table Lock</h2><blockquote>
<p>   上面介绍过SELECT … FOR UPDATE 的用法，不过锁定(Lock)的数据是判别就得要注意一下了。由于InnoDB 预设是Row-Level Lock，所以只有「明确」的指定主键，MySQL 才会执行Row lock (只锁住被选取的数据) ，否则MySQL 将会执行Table Lock (将整个数据表单给锁住)。</p>
</blockquote>
<p>举个例子:</p>
<p>假设有个表单products ，里面有id 跟name 二个栏位，id 是主键。</p>
<p>例1: (明确指定主键，并且有此数据，row lock)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE id=&#39;3&#39; FOR UPDATE;</span><br></pre></td></tr></table></figure></p>
<p>例2: (明确指定主键，若查无此数据，无lock)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE id=&#39;-1&#39; FOR UPDATE;</span><br></pre></td></tr></table></figure></p>
<p>例2: (无主键，table lock)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE name=&#39;Mouse&#39; FOR UPDATE;</span><br></pre></td></tr></table></figure></p>
<p>例3: (主键不明确，table lock)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE id&#60;&#62;&#39;3&#39; FOR UPDATE;</span><br></pre></td></tr></table></figure></p>
<p>例4: (主键不明确，table lock)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products WHERE id LIKE &#39;3&#39; FOR UPDATE;</span><br></pre></td></tr></table></figure></p>
<p>注1: FOR UPDATE 仅适用于InnoDB，且必须在事务区块(BEGIN/COMMIT)中才能生效。<br>注2: 要测试锁定的状况，可以利用MySQL 的Command Mode ，开二个视窗来做测试。  </p>
<h2 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="其他"></a>其他</h2><p><a href="http://www.cnblogs.com/chenwenbiao/archive/2012/06/06/2537508.html" target="_blank" rel="external">转自 http://www.cnblogs.com/chenwenbiao/archive/2012/06/06/2537508.html</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/08/do-not-work-hard-without-self-control/" itemprop="url">
                  没有自制力的人有什么资格谈努力
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-08-08T09:27:40+08:00" content="2016-08-08">
              2016-08-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日薪越亿/" itemprop="url" rel="index">
                    <span itemprop="name">日薪越亿</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/08/do-not-work-hard-without-self-control/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/08/do-not-work-hard-without-self-control/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u4E00"><a href="#u4E00" class="headerlink" title="一"></a>一</h2><p>在周鱼的微博上看到他的一段话 <code>你可以追剧追一晚，只要你可以按时交上论文。你可以有丰富的夜生活，只要第二天你还能精神饱满的做好本职工作。放纵究竟是不是错，取决于你能不能为你的放纵负责。还是那句话，没有自制力的人不足以谈人生。</code></p>
<p>简直一语戳中，微博底下留言的人，无一不在哀嚎：<strong>膝盖中箭。</strong></p>
<p>自制力并不是什么新鲜词，说白了就是能够自觉控制自己的行动和情绪，集中注意力去达成自己原本的目标，而不受其他事情的干扰。</p>
<p>可是说起来容易，做起来真是太难了。</p>
<p>对大多数人来说，论文通常都是在deadline来临时，才匆匆忙忙拼凑完成的，而在这之前，是逍遥地看剧打游戏，约会逛街.</p>
<p>工作也是，今天做不完那就明天再做咯，反正工作永远也做不完，但聊天八卦要跟上、剁手购物不能错过秒杀，就连无效的朋友聚餐打着“社交”的旗号也不能不去……</p>
<p>每天冲击我们的信息太多，要做的事情也太多，我们的时间也被分割成碎片，然后被鸡零狗碎所侵占，自制力一点一点丧失。</p>
<p>我们每天好像做了很多事，但为什么最后又好像什么都没做？</p>
<p>每天好像忙得团团转，焦头烂额，但为什么最后还是顾此失彼？</p>
<p>我们立下一堆目标和计划，最后一个也没完成，我们急吼吼地说要多么努力，我们甚至还曾以为自己很努力，原来不过就是看上去很努力而已，最后的结果是，想要做的事，和本应该完成的事，都没有完成。</p>
<p>丧失自制力的后果是让我们对自己愤怒和质疑:我们有什么资格谈努力？</p>
<h2 id="u4E8C"><a href="#u4E8C" class="headerlink" title="二"></a>二</h2><p>我一个朋友，她的出版资格考试报了三回，可一次也没去，是的，她连考场都没进。</p>
<p>最后她生生从考初级熬到了可以考中级资格（毕业五年可以直接考中级），她无所谓地说：“哎呀，大不了我直接考中级不就得了。”</p>
<p>其实在我看来，她这话无异于自欺欺人，没有个三五年，她中级一样考不下来。</p>
<p>还记得我们一起报名考初级的情景。</p>
<p>她特别豪言壮语地立下学习目标，用多长时间复习《著作权法》，用多长时间学习出版实操知识点……时间规划得特别详细，如实按照这个计划来，备考的时间完全充足，甚至还可以在一轮复习完了后，再进行重点知识二轮复习。</p>
<p>但我们相约一起复习的第一个周末她就缺席了。原因是，她们公司不久后要组织去某著名山庄泡温泉，开季度总结会，她想买一套新的泳衣，顺便去商场逛街，趁着打折买买换季的新衣服。</p>
<p>她打电话邀我作陪，“乔乔，这个礼拜你陪我逛街，下个礼拜我们再开始学习好不好？”</p>
<p>我回她一个微信：“你这个行为就像口口声声喊着要减肥，却大吃大喝一顿，还美其名曰‘没有吃饱怎么有力气减肥呢’？”</p>
<p>让我意外，其实也意料之中的是，第二个周末，第三个周末，她总是有事，最后我只好独自一个人把最初定下的学习计划执行下去。</p>
<p>起初，她还有些负罪感，但次数多了也就轻易地，自我放纵了。</p>
<p>时间好像还有很多，所以眼前的诱惑，相比很久以后的考试来说，总是更有吸引力一些，也更重要一些。甚至，还会偶尔劝诫自己“人生苦短，不如快活”。</p>
<p>到最后，临到考前一个月，她才开始急了，临时抱佛脚各种狂背，可是那些法律条款和实操的内容，真不是一时半会儿就能背下来的。</p>
<p>压力太大，她一焦虑，效率低下，就又没有学习的动力了。最后索性连考场也没去。</p>
<p>是的，自制力差的人，永远都有最后一道护身符：大不了重头再来咯。</p>
<p>第二年，她一个人报考，考前依旧信誓旦旦：“去年没完成的计划，今年誓死也要完成。”</p>
<p>然而，第二年依旧，乃至第三年。</p>
<p>没有自制力的人，往往容易拖延症爆发，总是觉得时间还有，偶尔开个小差做点别的并不影响大局，直到deadline逼近时才乱了阵脚，才意识到自己过高地估计了自己hold住场面的能力。</p>
<p>其实我们没有完成的那些事，并不如我们放弃的那么轻松，它们在我们看来其实很重要，没写完的论文，没做完的工作，没有看完的书，没有认真听的报告，没有背的单词，而我们在开小差的时候，也并不是心无旁骛地快乐，心好像被悬着，我们真的有负罪感，没法好好地玩耍。</p>
<h2 id="u4E09"><a href="#u4E09" class="headerlink" title="三"></a>三</h2><p>真正地有自制力，是一种怎样的体验？<br>　　<br>学生时期，我们身边都有这样的学霸，他好像从来不用做作业，上课也不是埋头苦做笔记，下了课更不会呆在座位上，他们可以跟学渣一起聊热门的电视剧，讨论流行的八卦，他们……好像真的没有认真地学习，但我们永远不知道的是: 他们在家专注地写作业和复习，一个小时的学习效率顶别人两三个小时。自制力强，所以效率高；自制力强，所以学得快，玩儿得也嗨。<br>　　<br>毕业后，职场上我们身边也有这样的同事，他们好像上班也跟你一起聊天八卦，也偶尔偷偷淘宝刷微博，做PPT的时候也一样抱怨，赶不出方案时也一样抓狂，可是，和你不同的是，在最后他们好像总是被上天眷顾了一样，ppt做得比你好看，方案创意比你厉害，销售单子拿的比你多……你气不过，暗自嘟囔“他凭什么？”<br>　　<br>是啊，你刷微博是在看娱乐八卦和搞笑图片，别人是在找创意灵感；你抱怨这不行那不行的时候是在发脾气，别人却是在寻找解决问题的办法；你跟别人闲聊是真的在撩骚，而别人是通过聊天找到对方的销售需求……<br>　　<br><strong>自制力强的人，永远分得清楚主次，拎得清什么是本职，什么是玩乐。Deadline在没有自制力的人那里，是压力；在有自制力的人那里，是动力。这就是本质的区别。</strong></p>
<h2 id="u56DB"><a href="#u56DB" class="headerlink" title="四"></a>四</h2><p>你是不是也有这样的经历：<br>　　<br>家里书架上都摆满了你想看的书，可是一两个月前，你兴冲冲翻开的那本，现在还是停留在最初的几页；<br>　　<br>你下载了背英语单词的App扇贝，你原本是踌躇满志地制订了背考研单词的计划，一天背100个单词，几十天就搞定，可是单词你背了又忘，忘了又背，中间断了N天。<br>　　<br>你办了健身卡说是要去学游泳，可是别人的健身卡都要续费了，你的健身卡套餐却是在不用就要过期了……<br>　　<br>为什么开始的开始，我们本来是兴冲冲要去做的事，到后来总是不了了之地烂尾？<br>　　<br>或许，我们缺乏自制力的原因之一就是，其实你内心深处，就是不在意，不那么想做，所以才会动力缺缺，一直拖延，一旦有什么别的事情干扰，你的专注力就无法维持。<br>　　<br>而什么是努力？吃喝玩乐睡，用不着努力，这些事是本能，是消遣。<br>　　<br>称得上努力的事，都是反本能反人性的：为了完成一个课题，你会起早贪黑；为了做那份你最想做的工作，上下班路上四五个小时你也无所谓；为了看完你想看的书，你会放弃参加无效的社交聚会……<br>　　<br><strong>亦舒曾说过，爱得不够，才借口多多。简直真理，套用过来，你不想做一件事，才会给自己找这样那样的理由。</strong><br>　　<br>所以，当我们在谈努力的时候，请扪心自问一下，你到底有多想做那件事？到底有多想成功？为了做成那件事，你到底能做到怎样的付出和拼命？<br>　　<br>因为没有自制力的人是没有资格谈努力的。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/18/self-management/" itemprop="url">
                  如何用管理的思维，规划好自己的人生？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-07-18T18:03:01+08:00" content="2016-07-18">
              2016-07-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日薪越亿/" itemprop="url" rel="index">
                    <span itemprop="name">日薪越亿</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/18/self-management/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/18/self-management/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u524D_u8BB0"><a href="#u524D_u8BB0" class="headerlink" title="前记"></a>前记</h2><p>如果要我选出大学最应该掌握的一项技能，毫无疑问，一定是做规划的能力。</p>
<p>为什么这么说呢？</p>
<p>我在之前的一篇文章里说过，不要以为进入了大学就可以放松了，大学只是另一条起跑线，而且，比高中要严峻得多。</p>
<p>原因很简单：不同于高中，大学里的一切，完全靠自己的主动性和驱动力。优秀的人，早在大一、大二，就已经清楚自己想要什么，开始集中精力往规划好的方向冲刺了。如果你等到大四才开始行动，其实就已经晚了。</p>
<p>举个栗子，有些朋友想进广告公司，但如果你等到毕业才去投简历，你会发现：广告公司根本不要没有经验的人，尤其是国际4A。那么，你不得不先到其他行业曲线救国，或者干脆放弃这个方向——你看，比起大二、大三就在4A里面实习，毕业后顺利成章留下来的，你比别人晚了多少？</p>
<p>再比如，有个朋友想进咨询行业（真事），结果到了临近毕业，才发现：优秀的咨询公司，不但对专业有着非常狭窄的要求（金融、计算机等），最低学历也是硕士，普通本科连面试的可能都没有，怎么办？如果早几年知道这件事，一早就可以转专业了，再不济，也可以提前准备考个研。</p>
<p>所以，为什么要做好规划？<strong>因为，我们人生当中的许多决策和选择，都要点满许多前置技能才会出</strong>现。如果你没有事先做好准备，你要么就只能花更多的时间去弥补，要么就只能像所有平庸的人一样，在那些门槛最低的选择中挑选和徘徊。</p>
<p>更进一步的是，很多时候，我们遇到的许多困境，乃至于使我们的人生变得平庸乏味的罪魁祸首，<strong>其实，都是因为我们活得太过随意。</strong></p>
<p>比如，我经常收到这样的私信：</p>
<ul>
<li><p>「大学学了个不喜欢的专业，一直很抵触，毕业之后也不知道做什么，就这样晃荡了一年，好无奈……」</p>
</li>
<li><p>「是不是我太眼高手低了？一年里换了好几份工作，每一份都待不久，现在很焦虑……」</p>
</li>
<li><p>「我一点都不喜欢现在的工作，但是又没有能力跳出来，每天都很忙，觉得未来的日子好迷茫……」</p>
</li>
</ul>
<p>其实，不满意现状并不可怕，可怕的是我们不知道该往什么方向改变。</p>
<p>这样的后果是什么？就像身在一个巨大的迷宫里，看不见周围的路线，日复一日地活在焦虑和迷茫之中，不断地往左往右试探着迈出步子，到头来却发现兜了一个巨大的圈子。就算能走出去，也是靠着运气，回过头看，更不知道走了多少冤枉路。</p>
<p>所以，每当遇到这种情况，我总会告诉他们，先尽最大的时间和精力，想清楚方向和规划。</p>
<p>在你没有一个清晰的——至少是初步的规划之前，一切的努力都是无意义的。它们只会成为大量的试错成本，成为在迷宫里一次次兜圈子的脚印，徒耗精力。</p>
<p>这篇文章，会结合项目管理的思维，谈谈如何做好人生里面，每一个阶段的规划。</p>
<h2 id="u4E00_u3001_u613F_u666F_uFF1A_u6211_u60F3_u6210_u4E3A_u4EC0_u4E48_u6837_u7684_u4EBA_uFF1F"><a href="#u4E00_u3001_u613F_u666F_uFF1A_u6211_u60F3_u6210_u4E3A_u4EC0_u4E48_u6837_u7684_u4EBA_uFF1F" class="headerlink" title="一、愿景：我想成为什么样的人？"></a>一、愿景：我想成为什么样的人？</h2><p>讲一个故事吧。</p>
<blockquote>
<p>   「我在店里吃早餐，看见有个女人跟店主起了争执。好像是店主少放了一颗蛋，她要求退钱，店主不肯。旁边有个女人，估计是她的朋友，一直在劝解。</p>
<p>   吵着吵着，那个女人突然坐下，捂住脸，哭了出来。</p>
<p>   她朋友吓了一跳，忙不迭地跟她说：不就一个蛋嘛，哭什么，咱们不要就是了。</p>
<p>   她抽泣着说，我不是哭这个，我是伤心，为什么我都30多了，却还要为了一个蛋跟别人吵架？这不是我想要的生活。」</p>
</blockquote>
<p>尽管作者的笔调多少带着一点促狭和调侃，但却给我留下了非常深刻的印象。</p>
<p>有多少人就像这样，曾对生活怀着各种各样的梦想和憧憬，却被现实一次又一次地迎头棒击，磨蚀锐气，最终成为自己以前最讨厌的那种人？</p>
<p>如果你不希望这样，如果你希望能够自己掌控自己的生活，那么，你可以先问自己这个问题：</p>
<p><strong>10年以后，我想成为一个什么样的人？</strong></p>
<p>你是想成为时尚前沿的焦点，出入时装周、酒会；还是想拥有自己的一间小店，一家工作室，享受充实而快节奏的事业；抑或是成为一名旅行美食撰稿人，天天飞往各地寻觅美食；又或者，是想安稳下来，拥有一间不大的房子，享受恬静的家庭生活？</p>
<p>无须进行过多的思考，相信自己的内心，捕捉住第一时间浮现出来的碎片——可能是一些形容词，一个场景，一种氛围，一些物质——将它们写在纸上，作为主干，然后，填充进必要的脉络、骨架，慢慢完善，直至将这种生活状态勾勒完整。</p>
<p>这个过程可能会花上几天，不要急，尽量遵从自己的内心。尽量写得更具体一些。</p>
<p>然后，准备一本空白的笔记本，打开第一页，将它写上去。</p>
<p>它将成为你往后一切努力的方向和根源。</p>
<h2 id="u4E8C_u3001_u95E8_u69DB_uFF1A_u6211_u8BE5_u6EE1_u8DB3_u4EC0_u4E48_u6837_u7684_u6761_u4EF6_uFF1F"><a href="#u4E8C_u3001_u95E8_u69DB_uFF1A_u6211_u8BE5_u6EE1_u8DB3_u4EC0_u4E48_u6837_u7684_u6761_u4EF6_uFF1F" class="headerlink" title="二、门槛：我该满足什么样的条件？"></a>二、门槛：我该满足什么样的条件？</h2><p>第一步的结果，只是帮助我们梳理出了自己想达到的生活状态。需要将它明确下来，进行分解，才能落实到后续的行动之中。</p>
<p>请打开笔记本，在第二页尽可能地罗列出你所知道的、达成目标需要满足的条件。</p>
<p>以开一间咖啡店为例，你需要满足的条件，可能是这样的：（未必准确，只是一个参考）</p>
<ul>
<li><p>一笔至少30万元的启动资金（视城市和地段而定。包括租金、装修以及前几个月的必要开支等）。</p>
</li>
<li><p>咖啡的相关知识。</p>
</li>
<li><p>店铺运营、资金管理、会计等基本商业知识。</p>
</li>
<li><p>市场营销及推广的基本知识。</p>
</li>
<li><p>平面设计、空间设计的基本知识（店面、LOGO设计和店内布局）。</p>
</li>
<li><p>有竞争优势的媒体资源和人脉关系。</p>
</li>
<li><p>稳定可靠的供货渠道。</p>
</li>
<li><p>大量的成熟案例参考资料。</p>
</li>
<li><p>……</p>
</li>
</ul>
<p>这样一来，你需要做什么，就非常清晰了。「能否在10年内开一家咖啡馆」，就变成「能否在10年内满足这些条件」。</p>
<p>不要急于求成，一开始你列出的条件，可能很不完整、不严谨，慢慢来。有疑问的地方，就去网上搜索资料，去知乎提问，或者请教对这方面比较熟悉的人，对这一页反复修改、增补，直到趋于完善为止。</p>
<h2 id="u4E09_u3001_u8DEF_u5F84_uFF1A_u6211_u8BE5_u5982_u4F55_u6EE1_u8DB3_u8FD9_u4E9B_u6761_u4EF6_uFF1F"><a href="#u4E09_u3001_u8DEF_u5F84_uFF1A_u6211_u8BE5_u5982_u4F55_u6EE1_u8DB3_u8FD9_u4E9B_u6761_u4EF6_uFF1F" class="headerlink" title="三、路径：我该如何满足这些条件？"></a>三、路径：我该如何满足这些条件？</h2><p>这是整个规划里面最重要的一步。</p>
<p>第二步列出的条件中，每一个问题，都有不同的解决方法。比如：</p>
<ul>
<li><p>会计和账目管理是一项非常繁琐的工作，你可以自己来，也可以跟朋友合伙、由他来负责这部分，也可以雇佣一位员工帮你分担；</p>
</li>
<li><p>店面设计、LOGO设计，你可以请朋友帮忙，也可以委托给专业的设计公司；</p>
</li>
<li><p>一开始的启动资金，你可以向家里人求助，可以向银行贷款，也可以自己一步步攒齐</p>
</li>
</ul>
<p>诸如此类。</p>
<p>不同的解决方法，会有不同的要求，要根据你的实际情况来处理。</p>
<ul>
<li><p>如果你家境良好，没有太多资金方面的压力，那显然，你就可以挑选一份比较轻松的工作，把省下来的时间和精力，去看市场营销方面的书籍，学习推广和运营知识，甚至到咖啡馆里面打工、积累经验，都可以。</p>
</li>
<li><p>如果你家境一般，打算靠自己攒齐启动资金，那你可能就得选择比较辛苦、加班较多，但收入也相对较高的工作。或者在业余时间接一些外包和私单，平时也多注意开源节流，以攒齐存款为第一优先级。</p>
</li>
<li><p>如果你的朋友里面有管理和财务方面的专业人才，关系也足够好，你就可以把这一块完全交给他，把自己的精力聚集在其他方面。</p>
</li>
<li><p>又或者，如果你打算在推广上面花大力气，那是不是可以选择新媒体相关的行业，积累这方面的经验和人际资源，为将来打好铺垫？</p>
</li>
<li><p>……</p>
</li>
</ul>
<p>翻开笔记本的第三页，把你的这些思考过程，详细地写下来。</p>
<ul>
<li><p>我拥有什么样的资源和优势？</p>
</li>
<li><p>我需要聚焦和关注哪些最核心的条件？</p>
</li>
<li><p>我可以采取什么方法解决它们？</p>
</li>
</ul>
<p>仔细思考这些问题，大量地去查找信息，在这个基础上，提炼出一份概要的「计划」，并对它反复进行打磨。</p>
<p>这一步的意义在于，<strong>只做那些对长远规划有益的事情。</strong></p>
<p>比如，我在之前的文章里提过，不要把时间浪费在低回报的兼职上。但是，如果你的长远目标是开一家咖啡店，那么到咖啡店里兼职有何不可呢？这个时候，它的回报就不是简单的金钱了，而是成为你整个规划必不可少的一环。</p>
<p>再比如，许多人一到周末，要么睡一天，要么逛街、玩游戏，这样没有什么问题，但是，如果你有一个长远的规划和方案，你是一定不会容忍自己这样的。你会去图书馆看书，会去练习技能，会早起去健身。</p>
<p>因为你清楚地知道，按照你的计划，只有这样，才能离你的梦想更近一步。</p>
<h2 id="u56DB_u3001_u91CF_u5316_uFF1A_u6211_u8981_u5B9E_u73B0_u4EC0_u4E48_u8FDB_u5EA6_uFF1F"><a href="#u56DB_u3001_u91CF_u5316_uFF1A_u6211_u8981_u5B9E_u73B0_u4EC0_u4E48_u8FDB_u5EA6_uFF1F" class="headerlink" title="四、量化：我要实现什么进度？"></a>四、量化：我要实现什么进度？</h2><p>为什么有些人制订了计划，却总是得不到落实，有些人却可以一步步朝着计划前进？</p>
<p>很大程度上，是由于计划本身的「有效性」。</p>
<p>什么是有效的计划呢？有一个通用的原则，叫做<strong>SMART原则</strong>。亦即<strong>「具体、可衡量、有可行性、有相关性、有时间期限」</strong>。</p>
<p>刨去可行性和相关性这两个显而易见的原则（目标必须有可能实现、目标必须与整体规划和其他目标相关），可以看出，最核心的部分，就是「量化」。用一句话来概括就是：<strong>我需要在什么时间点，达成什么样的进度？</strong></p>
<p>举个最简单的例子：</p>
<ul>
<li><p>「我要写一部小说」就不是一个计划；</p>
</li>
<li><p>「我要在3个月内完成一部60万字的小说，平均每周不少于5000字。」 就是一个初步的计划；</p>
</li>
<li><p>「我要在半年内完成一部小说，前3个月用于构思和准备素材，后3个月专注写作，平均每周不少于5000字，总字数不少于60万字。发布之后，在1个月内获得100个订阅，并且总体评价中好评需要超过60%。」 就是一个很完善的计划了。</p>
</li>
</ul>
<p>同样，「我要学习市场营销知识」只是一句空洞的话，如果要使之成为计划，可以这样设置：</p>
<blockquote>
<p>   「我要在1年内读完20本市场营销相关的专业书籍；每晚至少读30页书，学习1-3个知识点；每周至少写一篇不少于3000字的学习心得。」</p>
</blockquote>
<p>这样，就是一份有效、可执行的计划了。</p>
<p>请在笔记本上，翻开下一页，把确定下来的计划一条条列上去。</p>
<p>如果你有兴趣，可以做一份表格：横轴是每一项计划，纵轴是每一天的日期，再标出相应的进度和时间点。然后，每一天按照计划去「打卡」：今天读了25页书，就写上25；今天背了30个单词，就写上30。诸如此类。让自己对自己的执行情况、进度实现情况都能一目了然。</p>
<p>原则上，计划确立之后，不要频繁地去改动它。所以，一开始制订的时候，要根据实际情况控制好强度，最好设置在「需要付出一定努力就能够达到」的程度。这样才能对自己起到鞭策和激励的作用。</p>
<h2 id="u4E94_u3001_u53CD_u9988_uFF1A_u6211_u7684_u89C4_u5212_u5408_u7406_u5417_uFF1F"><a href="#u4E94_u3001_u53CD_u9988_uFF1A_u6211_u7684_u89C4_u5212_u5408_u7406_u5417_uFF1F" class="headerlink" title="五、反馈：我的规划合理吗？"></a>五、反馈：我的规划合理吗？</h2><p>人毕竟不是全知全能的，不可能一蹴而就。所以，在按照计划执行的时候，做好每一天的记录。试行一段时间之后，再根据这段时间的实际情况，对下一段时间的计划进行调整。</p>
<p>一般来说，1-3个月重新制订一次计划比较常见。以背单词为例，如果第一个月你给自己规定的计划是每天50个单词，1个月之后，你发现没有一天能达到目标，最多也不过30个单词，那么第二个月你就可以将目标设置为30，类似这样。</p>
<p>同样，在实行前文所说的长远规划时，如果你发现规划有误，或者有更好的方式可以满足条件，都可以及时对规划进行修改和调整。</p>
<p>末了，再多说几点。</p>
<p>首先，这是一个思维方式，亦即<strong>「规划-列出条件-找出方案-分解量化-反馈检查」</strong>。你可以把它应用到生活中的方方面面。比如，10年能不能变成1年、3年、5年，甚至半年？当然都可以。按照你想解决的实际问题来调整就好。</p>
<p>然后，如果你不知道开咖啡店需要多少钱，需要学习什么知识，怎么办？你可以在网上搜索资料，实在找不到的，去问身边的人（或者通过他们去问他们的朋友），去知乎和在行上找专业人士请教，或者，直接找一家咖啡店，跟老板搞好关系，跟他闲聊，都可以。获得信息的方法无穷无尽，不要止步于这个障碍上。</p>
<p>最后，讲个故事，给大家一点信心吧。</p>
<p>我有个朋友，大学的时候，每天回到宿舍就是玩游戏，周末也一直宅着。大四的时候，他去了一家游戏公司实习，做了两个月就辞职了。</p>
<p>「我不喜欢那种环境。」他说。「团队，同事，办公室，每天做的事情，我都不喜欢。太混乱，太low。」</p>
<p>后来呢？他回家休息了两年，学英语，考雅思，两年后，考进英国某排名前五的大学，读了个管理学硕士。回国之后，参加某跨国IT咨询公司的面试，在一片计算机专业的海归硕士和专业人士之中杀出重围，顺利拿到了助理顾问的职位。现在已经是某个team的leader。</p>
<p><strong>种一棵树最好的时间是十年前，其次就是现在。</strong></p>
<p>本文转自知乎专栏<a href="https://zhuanlan.zhihu.com/p/21627399" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/21627399</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/11/php-theory/" itemprop="url">
                  PHP 底层的运行机制与原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-07-11T09:27:40+08:00" content="2016-07-11">
              2016-07-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日薪越亿/" itemprop="url" rel="index">
                    <span itemprop="name">日薪越亿</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/11/php-theory/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/11/php-theory/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>PHP说简单，但是要精通也不是一件简单的事。我们除了会使用之外，还得知道它底层的工作原理。</p>
<p>PHP是一种适用于web开发的动态语言。具体点说，就是一个用C语言实现包含大量组件的软件框架。更狭义点看，可以把它认为是一个强大的UI框架。</p>
<p>了解PHP底层实现的目的是什么？动态语言要像用好首先得了解它，内存管理、框架模型值得我们借鉴，通过扩展开发实现更多更强大的功能，优化我们程序的性能。</p>
<h2 id="PHP_u7684_u8BBE_u8BA1_u7406_u5FF5_u53CA_u7279_u70B9"><a href="#PHP_u7684_u8BBE_u8BA1_u7406_u5FF5_u53CA_u7279_u70B9" class="headerlink" title="PHP的设计理念及特点"></a>PHP的设计理念及特点</h2><ul>
<li>多进程模型：由于PHP是多进程模型，不同请求间互不干涉，这样保证了一个请求挂掉不会对全盘服务造成影响，当然，随着时代发展，PHP也早已支持多线程模型。</li>
<li>弱类型语言：和C/C++、Java、C#等语言不同，PHP是一门弱类型语言。一个变量的类型并不是一开始就确定不变，运行中才会确定并可能发生隐式或显式的类型转换，这种机制的灵活性在web开发中非常方便、高效，具体会在后面PHP变量中详述。</li>
<li>引擎(Zend)+组件(ext)的模式降低内部耦合。</li>
<li>中间层(sapi)隔绝web server和PHP。</li>
<li>语法简单灵活，没有太多规范。缺点导致风格混杂，但再差的程序员也不会写出太离谱危害全局的程序。</li>
</ul>
<h2 id="PHP_u7684_u56DB_u5C42_u4F53_u7CFB"><a href="#PHP_u7684_u56DB_u5C42_u4F53_u7CFB" class="headerlink" title="PHP的四层体系"></a>PHP的四层体系</h2><p>PHP的核心架构如下图：</p>
<p><img src="http://sphenginx.github.io/images/php/theory.jpg" alt="PHP 核心架构图"></p>
<p>从图上可以看出，PHP从下到上是一个4层体系：</p>
<ul>
<li>Zend引擎：Zend整体用纯C实现，是PHP的内核部分，它将PHP代码翻译（词法、语法解析等一系列编译过程）为可执行opcode的处理并实现相应的处理方法、实现了基本的数据结构（如hashtable、oo）、内存分配及管理、提供了相应的api方法供外部调用，是一切的核心，所有的外围功能均围绕Zend实现。</li>
<li>Extensions：围绕着Zend引擎，extensions通过组件式的方式提供各种基础服务，我们常见的各种内置函数（如array系列）、标准库等都是通过extension来实现，用户也可以根据需要实现自己的extension以达到功能扩展、性能优化等目的（如贴吧正在使用的PHP中间层、富文本解析就是extension的典型应用）。</li>
<li>Sapi：Sapi全称是Server Application Programming Interface，也就是服务端应用编程接口，Sapi通过一系列钩子函数，使得PHP可以和外围交互数据，这是PHP非常优雅和成功的一个设计，通过sapi成功的将PHP本身和上层应用解耦隔离，PHP可以不再考虑如何针对不同应用进行兼容，而应用本身也可以针对自己的特点实现不同的处理方式。</li>
<li>上层应用：这就是我们平时编写的PHP程序，通过不同的sapi方式得到各种各样的应用模式，如通过webserver实现web应用、在命令行下以脚本方式运行等等。</li>
</ul>
<p>如果PHP是一辆车，那么车的框架就是PHP本身，Zend是车的引擎（发动机），Ext下面的各种组件就是车的轮子，Sapi可以看做是公路，车可以跑在不同类型的公路上，而一次PHP程序的执行就是汽车跑在公路上。因此，我们需要：性能优异的引擎+合适的车轮+正确的跑道。</p>
<h2 id="Sapi"><a href="#Sapi" class="headerlink" title="Sapi"></a>Sapi</h2><p>如前所述，Sapi通过通过一系列的接口，使得外部应用可以和PHP交换数据并可以根据不同应用特点实现特定的处理方法，我们常见的一些sapi有：</p>
<ul>
<li>apache2handler：这是以apache作为webserver，采用mod_PHP模式运行时候的处理方式，也是现在应用最广泛的一种。</li>
<li>cgi：这是webserver和PHP直接的另一种交互方式，也就是大名鼎鼎的fastcgi协议，在最近今年fastcgi+PHP得到越来越多的应用，也是异步webserver所唯一支持的方式。</li>
<li>cli：命令行调用的应用模式</li>
</ul>
<h2 id="PHP_u7684_u6267_u884C_u6D41_u7A0B_26amp_3Bopcode"><a href="#PHP_u7684_u6267_u884C_u6D41_u7A0B_26amp_3Bopcode" class="headerlink" title="PHP的执行流程&amp;opcode"></a>PHP的执行流程&amp;opcode</h2><p>我们先来看看PHP代码的执行所经过的流程。</p>
<p><img src="http://sphenginx.github.io/images/php/opcode.jpg" alt="opcode"></p>
<p>从图上可以看到，PHP实现了一个典型的动态语言执行过程：拿到一段代码后，经过词法解析、语法解析等阶段后，源程序会被翻译成一个个指令(opcodes)，然后ZEND虚拟机顺次执行这些指令完成操作。PHP本身是用C实现的，因此最终调用的也都是C的函数，实际上，我们可以把PHP看做是一个C开发的软件。</p>
<p>PHP的执行的核心是翻译出来的一条一条指令，也即opcode。</p>
<p>Opcode是PHP程序执行的最基本单位。一个opcode由两个参数(op1,op2)、返回值和处理函数组成。PHP程序最终被翻译为一组opcode处理函数的顺序执行。</p>
<p>常见的几个处理函数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ZEND_ASSIGN_SPEC_CV_CV_HANDLER : 变量分配 （<span class="variable">$a</span>=<span class="variable">$b</span>）</span><br><span class="line">ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER：函数调用</span><br><span class="line">ZEND_CONCAT_SPEC_CV_CV_HANDLER：字符串拼接 <span class="variable">$a</span>.<span class="variable">$b</span></span><br><span class="line">ZEND_ADD_SPEC_CV_CONST_HANDLER: 加法运算 <span class="variable">$a</span>+<span class="number">2</span></span><br><span class="line">ZEND_IS_EQUAL_SPEC_CV_CONST：判断相等 <span class="variable">$a</span>==<span class="number">1</span></span><br><span class="line">ZEND_IS_IDENTICAL_SPEC_CV_CONST：判断相等 <span class="variable">$a</span>===<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="HashTable__u2014__u6838_u5FC3_u6570_u636E_u7ED3_u6784"><a href="#HashTable__u2014__u6838_u5FC3_u6570_u636E_u7ED3_u6784" class="headerlink" title="HashTable — 核心数据结构"></a>HashTable — 核心数据结构</h2><p>HashTable是zend的核心数据结构，在PHP里面几乎并用来实现所有常见功能，我们知道的PHP数组即是其典型应用，此外，在zend内部，如函数符号表、全局变量等也都是基于hash table来实现。</p>
<p>PHP的hash table具有如下特点：</p>
<ul>
<li>支持典型的key-&gt;value查询</li>
<li>可以当做数组使用</li>
<li>添加、删除节点是O（1）复杂度</li>
<li>key支持混合类型：同时存在关联数组合索引数组</li>
<li>Value支持混合类型：array (“string”,2332)</li>
<li>支持线性遍历：如foreach</li>
</ul>
<p>Zend hash table实现了典型的hash表散列结构，同时通过附加一个双向链表，提供了正向、反向遍历数组的功能。其结构如下图：<br><img src="http://sphenginx.github.io/images/php/hashtable.jpg" alt="hashTable"></p>
<ul>
<li>可以看到，在hash table中既有key-&gt;value形式的散列结构，也有双向链表模式，使得它能够非常方便的支持快速查找和线性遍历。<br>散列结构：Zend的散列结构是典型的hash表模型，通过链表的方式来解决冲突。需要注意的是zend的hash table是一个自增长的数据结构，当hash表数目满了之后，其本身会动态以2倍的方式扩容并重新元素位置。初始大小均为8。另外，在进行key-&gt;value快速查找时候，zend本身还做了一些优化，通过空间换时间的方式加快速度。比如在每个元素中都会用一个变量nKeyLength标识key的长度以作快速判定。</li>
<li>双向链表：Zend hash table通过一个链表结构，实现了元素的线性遍历。理论上，做遍历使用单向链表就够了，之所以使用双向链表，主要目的是为了快速删除，避免遍历。Zend hash table是一种复合型的结构，作为数组使用时，即支持常见的关联数组也能够作为顺序索引数字来使用，甚至允许2者的混合。</li>
<li><p>PHP关联数组：关联数组是典型的hash_table应用。一次查询过程经过如下几步（从代码可以看出，这是一个常见的hash查询过程并增加一些快速判定加速查找。）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getKeyHashValue h;</span><br><span class="line">index = n &amp; nTableMask;</span><br><span class="line">Bucket *p = arBucket[index];</span><br><span class="line"><span class="keyword">while</span> (p) &#123;</span><br><span class="line">	<span class="keyword">if</span> ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength)) &#123;</span><br><span class="line">		<span class="keyword">RETURN</span> p-&gt;data;   </span><br><span class="line">	&#125;</span><br><span class="line">	p=p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">RETURN</span> FALTURE;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PHP索引数组：索引数组就是我们常见的数组，通过下标访问。例如 \$arr[0]，Zend HashTable内部进行了归一化处理，对于index类型key同样分配了hash值和nKeyLength(为0)。内部成员变量nNextFreeElement就是当前分配到的最大id，每次push后自动加一。正是这种归一化处理，PHP才能够实现关联和非关联的混合。由于push操作的特殊性，索引key在PHP数组中先后顺序并不是通过下标大小来决定，而是由push的先后决定。例如 \$arr[1] = 2; \$arr[2] = 3;对于double类型的key，Zend HashTable会将他当做索引key处理。</p>
</li>
</ul>
<h2 id="PHP_u53D8_u91CF"><a href="#PHP_u53D8_u91CF" class="headerlink" title="PHP变量"></a>PHP变量</h2><p>PHP是一门弱类型语言，本身不严格区分变量的类型。PHP在变量申明的时候不需要指定类型。PHP在程序运行期间可能进行变量类型的隐示转换。和其他强类型语言一样，程序中也可以进行显示的类型转换。PHP变量可以分为简单类型(int、string、bool)、集合类型(array resource object)和常量(const)。以上所有的变量在底层都是同一种结构 zval。</p>
<p>Zval是zend中另一个非常重要的数据结构，用来标识并实现PHP变量，其数据结构如下：<br><img src="http://sphenginx.github.io/images/php/zval.jpg" alt="zval"></p>
<p>Zval主要由三部分组成：</p>
<ul>
<li>type：指定了变量所述的类型（整数、字符串、数组等）</li>
<li>refcount&amp;is_ref：用来实现引用计数(后面具体介绍)</li>
<li>value：核心部分，存储了变量的实际数据</li>
</ul>
<p>Zvalue是用来保存一个变量的实际数据。因为要存储多种类型，所以zvalue是一个union，也由此实现了弱类型。</p>
<p>PHP变量类型和其实际存储对应关系如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IS_LONG   -&gt; lvalue</span><br><span class="line">IS_DOUBLE -&gt; dvalue</span><br><span class="line">IS_ARRAY  -&gt; ht</span><br><span class="line">IS_STRING -&gt; str</span><br><span class="line">IS_RESOURCE -&gt; lvalue</span><br></pre></td></tr></table></figure></p>
<p>引用计数在内存回收、字符串操作等地方使用非常广泛。PHP中的变量就是引用计数的典型应用。Zval的引用计数通过成员变量is_ref和ref_count实现，通过引用计数，多个变量可以共享同一份数据。避免频繁拷贝带来的大量消耗。</p>
<p>在进行赋值操作时，zend将变量指向相同的zval同时ref_count++，在unset操作时，对应的ref_count-1。只有ref_count减为0时才会真正执行销毁操作。如果是引用赋值，则zend会修改is_ref为1。</p>
<p>PHP变量通过引用计数实现变量共享数据，那如果改变其中一个变量值呢？当试图写入一个变量时，Zend若发现该变量指向的zval被多个变量共享，则为其复制一份ref_count为1的zval，并递减原zval的refcount，这个过程称为“zval分离”。可见，只有在有写操作发生时zend才进行拷贝操作，因此也叫copy-on-write(写时拷贝)</p>
<p>对于引用型变量，其要求和非引用型相反，引用赋值的变量间必须是捆绑的，修改一个变量就修改了所有捆绑变量。</p>
<p>整数、浮点数是PHP中的基础类型之一，也是一个简单型变量。对于整数和浮点数，在zvalue中直接存储对应的值。其类型分别是long和double。</p>
<p>从zvalue结构中可以看出，对于整数类型，和c等强类型语言不同，PHP是不区分int、unsigned int、long、long long等类型的，对它来说，整数只有一种类型也就是long。由此，可以看出，在PHP里面，整数的取值范围是由编译器位数来决定而不是固定不变的。</p>
<p>对于浮点数，类似整数，它也不区分float和double而是统一只有double一种类型。</p>
<p>在PHP中，如果整数范围越界了怎么办？这种情况下会自动转换为double类型，这个一定要小心，很多trick都是由此产生。</p>
<p>和整数一样，字符变量也是PHP中的基础类型和简单型变量。通过zvalue结构可以看出，在PHP中，字符串是由由指向实际数据的指针和长度结构体组成，这点和c++中的string比较类似。由于通过一个实际变量表示长度，和c不同，它的字符串可以是2进制数据（包含\0），同时在PHP中，求字符串长度strlen是O(1)操作。</p>
<p>在新增、修改、追加字符串操作时，PHP都会重新分配内存生成新的字符串。最后，出于安全考虑，PHP在生成一个字符串时末尾仍然会添加\0</p>
<p>常见的字符串拼接方式及速度比较：</p>
<p>假设有如下4个变量：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$strA</span> = <span class="string">'123'</span>; </span><br><span class="line"><span class="variable">$strB</span> = <span class="string">'456'</span>; </span><br><span class="line"><span class="variable">$intA</span> = <span class="number">123</span>; </span><br><span class="line"><span class="variable">$intB</span> = <span class="number">456</span>;</span><br></pre></td></tr></table></figure></p>
<p>现在对如下的几种字符串拼接方式做一个比较和说明：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$res</span> = <span class="variable">$strA</span>.<span class="variable">$strB</span>和<span class="variable">$res</span> = “<span class="variable">$strA</span><span class="variable">$strB</span>”</span><br><span class="line">这种情况下，zend会重新malloc一块内存并进行相应处理，其速度一般</span><br><span class="line"><span class="variable">$strA</span> = <span class="variable">$strA</span>.<span class="variable">$strB</span></span><br><span class="line">这种是速度最快的，zend会在当前strA基础上直接relloc，避免重复拷贝</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$intA</span>.<span class="variable">$intB</span></span><br><span class="line">这种速度较慢，因为需要做隐式的格式转换，实际编写程序中也应该注意尽量避免</span><br><span class="line"><span class="variable">$strA</span> = sprintf (“%s%s”,<span class="variable">$strA</span>.<span class="variable">$strB</span>);</span><br><span class="line">这会是最慢的一种方式，因为sprintf在PHP中并不是一个语言结构，本身对于格式识别和处理就需要耗费比较多时间，另外本身机制也是malloc。不过sprintf的方式最具可读性，实际中可以根据具体情况灵活选择。</span><br></pre></td></tr></table></figure></p>
<p>PHP的数组通过Zend HashTable来天然实现。</p>
<p>foreach操作如何实现？对一个数组的foreach就是通过遍历hashtable中的双向链表完成。对于索引数组，通过foreach遍历效率比for高很多，省去了key-&gt;value的查找。count操作直接调用HashTable-&gt;NumOfElements，O(1)操作。对于’123’这样的字符串，zend会转换为其整数形式。\$arr[‘123’]和\$arr[123]是等价的</p>
<p>资源类型变量是PHP中最复杂的一种变量，也是一种复合型结构。</p>
<p>PHP的zval可以表示广泛的数据类型，但是对于自定义的数据类型却很难充分描述。由于没有有效的方式描绘这些复合结构，因此也没有办法对它们使用传统的操作符。要解决这个问题，只需要通过一个本质上任意的标识符（label）引用指针，这种方式被称为资源。</p>
<p>在zval中，对于resource，lval作为指针来使用，直接指向资源所在的地址。Resource可以是任意的复合结构，我们熟悉的mysqli、fsock、memcached等都是资源。</p>
<p>如何使用资源：</p>
<ul>
<li>注册：对于一个自定义的数据类型，要想将它作为资源。首先需要进行注册，zend会为它分配全局唯一标示。</li>
<li>获取一个资源变量：对于资源，zend维护了一个id-&gt;实际数据的hash_tale。对于一个resource，在zval中只记录了它的id。fetch的时候通过id在hash_table中找到具体的值返回。</li>
<li>资源销毁：资源的数据类型是多种多样的。Zend本身没有办法销毁它。因此需要用户在注册资源的时候提供销毁函数。当unset资源时，zend调用相应的函数完成析构。同时从全局资源表中删除它。</li>
</ul>
<p>资源可以长期驻留，不只是在所有引用它的变量超出作用域之后，甚至是在一个请求结束了并且新的请求产生之后。这些资源称为持久资源，因为它们贯通SAPI的整个生命周期持续存在，除非特意销毁。很多情况下，持久化资源可以在一定程度上提高性能。比如我们常见的mysql_pconnect ,持久化资源通过pemalloc分配内存，这样在请求结束的时候不会释放。 对zend来说，对两者本身并不区分。</p>
<p>PHP中的局部变量和全局变量是如何实现的？对于一个请求，任意时刻PHP都可以看到两个符号表(symbol_table和active_symbol_table)，其中前者用来维护全局变量。后者是一个指针，指向当前活动的变量符号表，当程序进入到某个函数中时，zend就会为它分配一个符号表x同时将active_symbol_table指向a。通过这样的方式实现全局、局部变量的区分。</p>
<p>获取变量值：PHP的符号表是通过hash_table实现的，对于每个变量都分配唯一标识，获取的时候根据标识从表中找到相应zval返回。</p>
<p>函数中使用全局变量：在函数中，我们可以通过显式申明global来使用全局变量。在active_symbol_table中创建symbol_table中同名变量的引用，如果symbol_table中没有同名变量则会先创建。</p>
<h2 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="其他"></a>其他</h2><p>原文转自：<a href="http://www.nowamagic.net/librarys/veda/detail/102" target="_blank" rel="external">http://www.nowamagic.net/librarys/veda/detail/102</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/05/why-overtime-doesnt-work/" itemprop="url">
                  为了项目上线而加班，真有必要吗？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-05-05T15:05:01+08:00" content="2016-05-05">
              2016-05-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日薪越亿/" itemprop="url" rel="index">
                    <span itemprop="name">日薪越亿</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/05/why-overtime-doesnt-work/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/05/why-overtime-doesnt-work/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><img src="http://sphenginx.github.io/images/overtime.jpg" alt="I has to work overtime again today"></p>
<p>大家都知道：软件项目的加班可能真是有百害而无一利，但总还有些时候，有些人有侥幸心理，或是现实情况实在无法让步，比如项目必须在某个日期上线； 在这些情况下，应该跟团队沟通些什么？Quora资深软件工程师Edmond Lau在自己的一篇博客中，给出了自己的看法。这篇博客名为<a href="http://www.theeffectiveengineer.com/blog/why-overtime-doesnt-work" target="_blank" rel="external">《为了满足项目上线日期要求，我该怎么告诉我的团队工作更多时间？》</a>。</p>
<p>文章一开始，Edmond指出：</p>
<blockquote>
<p>在试图告诉团队要加班之前，一定要确保一点：为了保证上线日期，你有一个切实可行的计划。否则，从长远来看的最佳策略是：根据团队当前开发能力和效率，重新定义要上线的功能；或者将截止日期重新调整为更现实的时间。</p>
</blockquote>
<p>接下来，Edmond列举了自己的亲身经验。他曾参与过两个持续多月大型项目，而且团队成员都是高手，专注投入在这两个项目上。为了在某个日期之前上线，工程经理要求团队加班工作，每周60到70个小时。可是项目最后还是没有按时完成。Edmond这样回顾项目的后果：</p>
<blockquote>
<p>这样的方式让一些团队成员筋疲力尽，有些人后来离开了，其他人用了很久才恢复过来。这两个项目的情况都无法判断：加班是否真能加快进度，加班的决策在当时也许很合理，但是长远来看，两只团队都深受其害。我们从这两个项目中学到惨痛的教训：<code>不管你多么希望项目在某个日期前完成，都对它能否做到这一点毫无帮助。不要将积极思考与现实的乐观主义混为一谈。</code></p>
</blockquote>
<p>Edmond列举了几个加班无助于项目尽快交付的原因：</p>
<ul>
<li>工作更多时间，每小时的效率将会降低。</li>
</ul>
<blockquote>
<p>如果你的团队已经习惯了每周40小时工作的生活节奏，而且一年来都是如此，那么很可能他们加班的效率会低于平常，甚至可能产生负面影响。疲累和睡眠减少会伤害认知功能，而且降低工作质量。</p>
</blockquote>
<p>他还列举了150年以来的研究文献，证明这一点，而且有些文献甚至说明：如果加班过多，</p>
<blockquote>
<p>有问题的工作累计带来的负面影响，会导致项目完成日期延迟，甚至比同样的团队按照每周40小时的工作节奏完成得还要晚。</p>
</blockquote>
<ul>
<li>很可能你现在落后的时间进度比你以为的还要多。</li>
</ul>
<blockquote>
<p>在工程中，做出准确的项目估算非常难以做到。进度已经晚了，说明上个月的工作就估算得不够。所以，可能过去的工作估算少了，更有可能的是：整个项目都估算少了，包括剩下几个月的工作。</p>
<p>我们在项目开始时估算得要比项目结束时准确，因为开始时的工作重点放在可以深入理解的工作之上；到结束时，团队常常低估整合测试用去的时间&gt; ，而且每个没有预料到的问题都会让进度延后一周甚至更多。这些效应叠加起来会产生更多延迟。</p>
</blockquote>
<p>他引用了《人月神话》里面的话：</p>
<blockquote>
<p>特别是没有为系统测试留出足够时间，这会带来灾难性后果。因为延迟是在项目日程结束时来临的，除非交付日期快到了，没人会意识到进度上的问题。</p>
</blockquote>
<ul>
<li>额外的工作时间会让团队精疲力竭。<br>Edmond引用了《人件》中的一个症状：“undertime”，也就是说：跟随加班而来的，常常是员工为了要补偿生活方面的损失，而在工作中耗费时间去做与工作无关之事。</li>
</ul>
<blockquote>
<p>我们的经验指出：额外工作时间的积极影响被大大夸大了，而其负面影响却从未有人考量。负面影响可能十分严重：错误、倦怠、失误不断增多、补偿用的“undertime”等等。</p>
</blockquote>
<ul>
<li><p>额外的工作时间会伤害团队士气。<br>在Edmond看来，加班之前，可能团队每个人都有自己的方式来完成每周40小时的工作，而且还能保证团队的凝聚力。一旦要加班，可能某些人就要多完成一些不能多加班的人要做的事情，这会影响彼此之间的关系，以前开心的团队，现在可能就不开心了。</p>
</li>
<li><p>管理向截止日期的冲刺，需要耗费更多管理开销。</p>
</li>
</ul>
<blockquote>
<p>为了管理额外工作而举行更多站立会议和其他会议，这很常见，因为你希望团队要彼此沟通，保证每个人都在做正确的事情。然而，这种额外的沟通开销常常不会放在工作估算中。</p>
</blockquote>
<ul>
<li>向截止日期的冲刺，会刺激产生更多技术债务。<br>Edmond认为：为了赶进度而加班，几乎不可避免地会令得团队找捷径。而且在面临更多项目压力的情况下，这些技术债务很可能越积越多，将来一定要付出更多成本偿还。</li>
</ul>
<p>不过，总有些现实情况不可避免，真到那时候，Edmond建议在沟通时要强调一下因素。</p>
<ul>
<li>要理解为什么进度落了这么远，找出根本原因，还要与团队沟通。</li>
</ul>
<blockquote>
<p>没赶上进度，是因为人们偷懒，还是因为项目要比想象的复杂，要占用更多时间？如果不能理解根本原因，也就不能有信心同样的问题不会在未来几个月出现。</p>
</blockquote>
<ul>
<li>向团队说明更可行的项目计划和时间进度，说明为什么要加班才能真正赶上上线日期，还要说明怎么做。</li>
</ul>
<blockquote>
<p>仅仅告诉团队他们落后了还不够，如果不能得出更详细、更明确的计划达成目标，这就是一个警告信号，说明你比你以为的情况更落后。</p>
</blockquote>
<ul>
<li>确保团队每个人都能理解、认同你的新进度安排。</li>
</ul>
<blockquote>
<p>如果关键成员不相信你的时间表可行，那就得好好想想：你可能无法在新的指定日期前完成你想完成的工作。要是无法做到所有人都认可，那么可能只有某些人认同加班，除了团队中会有不公平的感觉之外，可能你还是无法达成最后完成日期。</p>
</blockquote>
<ul>
<li>重点放在项目、团队或是组织的整体工作目标上，说明为什么按时上线如此重要。</li>
</ul>
<blockquote>
<p>如果你无法把团队融合在一起，这就是另一个警讯：说明不是所有人都像你这么有动力去加班。</p>
</blockquote>
<p>最后，Edmond指出：</p>
<blockquote>
<p>如果，在接下来冲刺的两个月时间里，你发现实际进度比修正后的还要延迟，那就准备放弃这个冲刺吧。接受现实，知道你可能是在马拉松的半程发起了冲刺，而终点线比你想的要远得多。不再可能让团队更努力去解决问题了。减少损失，不妨想想怎么制订一个应急计划应对后续问题。</p>
<p>错过截止日期很糟糕，但要是错过了截止日期，而且让团队精疲力尽，而且没有应急计划，这就更糟糕了。</p>
</blockquote>
<p>译文出处: <a href="http://www.infoq.com/cn/news/2013/08/how-to-tell-team-to-overtime" target="_blank" rel="external">InfoQ</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars1.githubusercontent.com/u/1829395?v=3&s=460" alt="Sphenginx" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Sphenginx</p>
        </div>
        <p class="site-description motion-element" itemprop="description">认真生活，开心工作！</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">44</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sphenginx" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/sphenginx" target="_blank">
                  
                    <i class="fa fa-globe"></i> weibo
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sphenginx</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"sphenginx"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
